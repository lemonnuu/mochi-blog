import{_ as s,c as n,o as a,a as l}from"./app.7f3b158c.js";const d=JSON.parse('{"title":"MongoDB","titleTemplate":false,"description":"","frontmatter":{"date":"2023-01-20 08:45:20","title":"MongoDB","titleTemplate":false,"author":"Mochi","outline":[2,4],"categories":["post"],"tags":["node","mongodb"]},"headers":[{"level":2,"title":"安装","slug":"安装","link":"#安装","children":[{"level":3,"title":"windows","slug":"windows","link":"#windows","children":[]},{"level":3,"title":"Ubuntu","slug":"ubuntu","link":"#ubuntu","children":[]}]},{"level":2,"title":"基本命令","slug":"基本命令","link":"#基本命令","children":[{"level":3,"title":"连接 MongoDB","slug":"连接-mongodb","link":"#连接-mongodb","children":[]},{"level":3,"title":"查看所有数据库","slug":"查看所有数据库","link":"#查看所有数据库","children":[]},{"level":3,"title":"查看当前数据库","slug":"查看当前数据库","link":"#查看当前数据库","children":[]},{"level":3,"title":"创建数据库/集合","slug":"创建数据库-集合","link":"#创建数据库-集合","children":[]},{"level":3,"title":"退出数据库","slug":"退出数据库","link":"#退出数据库","children":[]},{"level":3,"title":"删除数据库","slug":"删除数据库","link":"#删除数据库","children":[]},{"level":3,"title":"删除集合","slug":"删除集合","link":"#删除集合","children":[]},{"level":3,"title":"向集合中插入数据","slug":"向集合中插入数据","link":"#向集合中插入数据","children":[]},{"level":3,"title":"查找内容","slug":"查找内容","link":"#查找内容","children":[]},{"level":3,"title":"更新内容","slug":"更新内容","link":"#更新内容","children":[]},{"level":3,"title":"删除内容","slug":"删除内容","link":"#删除内容","children":[]}]},{"level":2,"title":"Node.js 中使用 MongoDB","slug":"node-js-中使用-mongodb","link":"#node-js-中使用-mongodb","children":[{"level":3,"title":"mongodb","slug":"mongodb-1","link":"#mongodb-1","children":[]},{"level":3,"title":"mongoose","slug":"mongoose","link":"#mongoose","children":[]}]},{"level":2,"title":"使用场景","slug":"使用场景","link":"#使用场景","children":[]}],"relativePath":"_POSTS/node/007_mongodb.md","lastUpdated":1674194615000}'),o={name:"_POSTS/node/007_mongodb.md"},p=l(`<h1 id="mongodb" tabindex="-1">MongoDB <a class="header-anchor" href="#mongodb" aria-hidden="true">#</a></h1><p><a href="https://www.mongodb.com/try/download/community" target="_blank" rel="noreferrer">MongoDB</a> 是一个文档数据库, 由 C++ 语言编写。它是一个介于关系型数据库和非关系型数据库之间的产品, 是非关系型数据库当中功能最丰富, 最像关系型数据库的。</p><h2 id="安装" tabindex="-1">安装 <a class="header-anchor" href="#安装" aria-hidden="true">#</a></h2><p>MongoDB 次版本为奇数时表示的是测试版, 为偶数时表示的是稳定版, 建议安装稳定版。此安装版本为 MongoDB@6.0.3。</p><h3 id="windows" tabindex="-1">windows <a class="header-anchor" href="#windows" aria-hidden="true">#</a></h3><p><a href="https://www.mongodb.com/docs/manual/tutorial/install-mongodb-on-windows/https://www.mongodb.com/try/download/community" target="_blank" rel="noreferrer">MongoDB</a> 版本 6 及其以上和版本 5 的安装有些差异。MongoDB@6 不再内置 MongoDB shell, 也就是以前的 <code>mongo</code> 命令不能使用了, 需要手动安装 <a href="https://www.mongodb.com/try/download/shell" target="_blank" rel="noreferrer">MongoDB Shell</a> 才能在使用命令行工具。</p><p>在安装 MongoDB 时可以选择 custom 自定义安装路径, 需要注意的是不要勾选安装 MongoDB Compass, 后面会安装更合适的 Navicat Premium。</p><p>在安装 MongoDB shell 时只需下载解压即可, 可以把其 bin 目录下的文件丢入 MongoDB 的 bin 目录下, 然后再为 bin 目录添加 path 环境变量即可。path 环境变量的查找要求终端具有管理员权限。</p><h3 id="ubuntu" tabindex="-1">Ubuntu <a class="header-anchor" href="#ubuntu" aria-hidden="true">#</a></h3><p>详见 <a href="./../pits/002ubuntu-install-mongodb.html">Ubuntu@22.04 安装 MongoDB 出错解决</a></p><h2 id="基本命令" tabindex="-1">基本命令 <a class="header-anchor" href="#基本命令" aria-hidden="true">#</a></h2><blockquote><p><a href="https://docs.mongoing.com/" target="_blank" rel="noreferrer">MongoDB 文档地址</a></p></blockquote><h3 id="连接-mongodb" tabindex="-1">连接 MongoDB <a class="header-anchor" href="#连接-mongodb" aria-hidden="true">#</a></h3><p>以管理员权限打开终端, 执行：</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">mongosh</span></span>
<span class="line"></span></code></pre></div><h3 id="查看所有数据库" tabindex="-1">查看所有数据库 <a class="header-anchor" href="#查看所有数据库" aria-hidden="true">#</a></h3><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">show</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">dbs</span></span>
<span class="line"></span></code></pre></div><p>注：admin、config 与 local 为 MongoDB 内置数据库。</p><h3 id="查看当前数据库" tabindex="-1">查看当前数据库 <a class="header-anchor" href="#查看当前数据库" aria-hidden="true">#</a></h3><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">db</span></span>
<span class="line"></span></code></pre></div><h3 id="创建数据库-集合" tabindex="-1">创建数据库/集合 <a class="header-anchor" href="#创建数据库-集合" aria-hidden="true">#</a></h3><p>MongoDB 创建『数据库/集合』没有显式的指令, 只要往数据库里面塞了值, 数据库就自动创建</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">use</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mytest</span></span>
<span class="line"><span style="color:#FFCB6B;">db.cc.insertOne(</span><span style="color:#89DDFF;">{</span><span style="color:#FFCB6B;">x:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">y:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#C3E88D;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><h3 id="退出数据库" tabindex="-1">退出数据库 <a class="header-anchor" href="#退出数据库" aria-hidden="true">#</a></h3><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#82AAFF;">exit</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 或</span></span>
<span class="line"><span style="color:#82AAFF;">quit</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 或者直接暴力 Ctrl + C</span></span>
<span class="line"></span></code></pre></div><h3 id="删除数据库" tabindex="-1">删除数据库 <a class="header-anchor" href="#删除数据库" aria-hidden="true">#</a></h3><p>MongoDB 删除数据库只能切换到当前数据库, 也就是说, MongoDB 的数据库只能&quot;自杀&quot;。</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#82AAFF;">db.dropDatabase</span><span style="color:#89DDFF;">()</span></span>
<span class="line"></span></code></pre></div><h3 id="删除集合" tabindex="-1">删除集合 <a class="header-anchor" href="#删除集合" aria-hidden="true">#</a></h3><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#82AAFF;">db.cc.drop</span><span style="color:#89DDFF;">()</span></span>
<span class="line"></span></code></pre></div><h3 id="向集合中插入数据" tabindex="-1">向集合中插入数据 <a class="header-anchor" href="#向集合中插入数据" aria-hidden="true">#</a></h3><p>向集合中插入一条数据可使用 <code>insertOne()</code>, 插入多条数据可使用 <code>insertMany()</code></p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">db.cc.insertOne(</span><span style="color:#89DDFF;">{</span><span style="color:#FFCB6B;">x:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">y:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#C3E88D;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#FFCB6B;">db.cc.insertMany([</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">{</span><span style="color:#FFCB6B;">x:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#C3E88D;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">y:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">4</span><span style="color:#C3E88D;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">{</span><span style="color:#FFCB6B;">x:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">4</span><span style="color:#C3E88D;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">y:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">8</span><span style="color:#C3E88D;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">])</span></span>
<span class="line"></span></code></pre></div><h3 id="查找内容" tabindex="-1">查找内容 <a class="header-anchor" href="#查找内容" aria-hidden="true">#</a></h3><p>查找所有内容</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#82AAFF;">db.cc.find</span><span style="color:#89DDFF;">()</span></span>
<span class="line"></span></code></pre></div><p>查找指定内容需要给 <code>find()</code> 方法传递一个对象, <code>$gt</code> 表示大于, <code>$lt</code> 表示小于</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">db.cc.find(</span><span style="color:#89DDFF;">{</span><span style="color:#FFCB6B;">x:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">{</span><span style="color:#A6ACCD;">$gt</span><span style="color:#C3E88D;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#C3E88D;">}}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><p>如果只想获取一条数据, 使用 <code>findOne()</code> 即可</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">db.cc.findOne(</span><span style="color:#89DDFF;">{</span><span style="color:#FFCB6B;">x:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">{</span><span style="color:#A6ACCD;">$lt</span><span style="color:#C3E88D;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#C3E88D;">}}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><h3 id="更新内容" tabindex="-1">更新内容 <a class="header-anchor" href="#更新内容" aria-hidden="true">#</a></h3><p>如果想更新一条数据使用 <code>updateOne()</code>, 更新多条使用 <code>updateMany()</code>, 注意只能更新 value, 不能更新 key, 且需要使用 <code>$set</code> 赋值</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">db.cc.updateOne(</span><span style="color:#89DDFF;">{</span><span style="color:#FFCB6B;">x:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;">},</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">{</span><span style="color:#A6ACCD;">$set</span><span style="color:#C3E88D;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">{x:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">11</span><span style="color:#C3E88D;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">y:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">22</span><span style="color:#C3E88D;">}}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><h3 id="删除内容" tabindex="-1">删除内容 <a class="header-anchor" href="#删除内容" aria-hidden="true">#</a></h3><p>如果想删除一条内容可以使用 <code>deleteOne()</code>, 删除多条使用 <code>deleteMany()</code></p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">db.cc.deleteOne(</span><span style="color:#89DDFF;">{</span><span style="color:#FFCB6B;">x:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#C3E88D;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><h2 id="node-js-中使用-mongodb" tabindex="-1">Node.js 中使用 MongoDB <a class="header-anchor" href="#node-js-中使用-mongodb" aria-hidden="true">#</a></h2><h3 id="mongodb-1" tabindex="-1">mongodb <a class="header-anchor" href="#mongodb-1" aria-hidden="true">#</a></h3><p>Node.js 中操作 MongoDB 可以使用 <a href="https://www.npmjs.com/package/mongodb" target="_blank" rel="noreferrer">mongodb</a> 库。</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mongodb</span></span>
<span class="line"></span></code></pre></div><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> MongoClient </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">mongodb</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// or as an es module:</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// import { MongoClient } from &#39;mongodb&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// Connection URL</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> url </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">mongodb://localhost:27017</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> client </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">MongoClient</span><span style="color:#A6ACCD;">(url)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// Database Name</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> dbName </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">myProject</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// Use connect method to connect to the server</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">client</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">connect</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Connected successfully to server</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">db</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">client</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">db</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">dbName</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">collection</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">db</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">collection</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">documents</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// the following code examples can be pasted here...</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">allData</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">cc</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">find</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">allData</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toArray</span><span style="color:#F07178;">())</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">done.</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(console</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">log)</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">catch</span><span style="color:#A6ACCD;">(console</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">error)</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">finally</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> client</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">close</span><span style="color:#A6ACCD;">())</span></span>
<span class="line"></span></code></pre></div><p>在使用完 main 方法后一定一定要把数据库连接关闭。</p><p><code>find()</code> 方法返回的是游标, 想要得到实际的数据还需要 <code>await data.toArray()</code>。</p><h3 id="mongoose" tabindex="-1">mongoose <a class="header-anchor" href="#mongoose" aria-hidden="true">#</a></h3><p><a href="https://www.npmjs.com/package/mongoose" target="_blank" rel="noreferrer">mongoose</a> 是在 mongodb 基础上二次封装的库, 有着更友好的 API, 实际开发中基本是使用它。</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mongoose</span></span>
<span class="line"></span></code></pre></div><p>与 mongodb 不同, mongoose 在连接 url 中就需要指定需要连接的数据库。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> mongoose </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">mongoose</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> database </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">mytest</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> main </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">mongoose</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">connect</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">mongodb://127.0.0.1:27017/</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">database</span><span style="color:#89DDFF;">}\`</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">数据库连接成功✔️</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">catch</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">数据库连接失败❌</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><p>如若想对数据库的集合进行操作, 需要：</p><ol><li>创建 Schema, 表示集合结构, 如：<code>const userSchema = new mongoose.Schema({username: String})</code></li><li>定义 Model, 表示集合模型, 如：<code>const User = mongoose.model(&#39;user&#39;, userSchema)</code></li><li>实例化 Model, 如：<code>const userModel = new User({username: &#39;abc&#39;})</code></li><li>操作都是通过实例化的 Model 完成, 如 <code>await userModel.save()</code></li></ol><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> ccSchema </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> mongoose</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Schema</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">x</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> Number</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">y</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> Number</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> cc </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> mongoose</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">model</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">cc</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> ccSchema)</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> ccModel </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">cc</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">x</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">y</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> dbBack </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#A6ACCD;"> ccModel</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">save</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(dbBack)</span></span>
<span class="line"></span></code></pre></div><p>需要注意的是, 定义 Model 时, 第一个参数是集合的参数名称, 一般是大写, mongoose 会自动查找其复数形式。例如：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// 实际操作的集合是 Tickets</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> MyModel </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> mongoose</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">model</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Ticket</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> mySchema)</span></span>
<span class="line"></span></code></pre></div><h2 id="使用场景" tabindex="-1">使用场景 <a class="header-anchor" href="#使用场景" aria-hidden="true">#</a></h2><ol><li>对数据处理性能有较高要求</li><li>需要借助缓存层来处理数据</li><li>需要高度的伸缩性</li></ol>`,65),e=[p];function c(t,r,y,i,C,D){return a(),n("div",null,e)}const A=s(o,[["render",c]]);export{d as __pageData,A as default};
